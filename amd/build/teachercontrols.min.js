define("quizaccess_tcquiz/teachercontrols",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Allows the teacher to control the polling of one question.
   * Currently, the teacher can only stop the question.
   *
   * @module     quizaccess_tcquiz
   * @copyright  2024 Capilano University
   * @author     Tamara Dakic <tdakic@capilanou.ca>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const Selectors={actions:{endquestionButton:'[data-action="quizaccess_tcquiz/end-question_button"]'},regions:{numAnswers:'[data-region="quizaccess_tcquiz/numberanswers_span"]',timeLeft:'[data-region="quizaccess_tcquiz/timeleft_span"]'}},registerEventListeners=(sessionid,quizid,cmid,attemptid,page,timeForQuestion,POLLING_INTERVAL)=>{window.addEventListener("beforeunload",(function(event){event.stopImmediatePropagation()}));document.querySelector(Selectors.actions.endquestionButton).addEventListener("click",(async e=>{e.preventDefault(),clearInterval(updateNumAnswersEvent),updateNumAnswersEvent=null,document.querySelector(Selectors.regions.timeLeft).innerHTML=0,clearInterval(timer),timer=null;const req=new XMLHttpRequest;req.open("POST",M.cfg.wwwroot+"/mod/quiz/accessrule/tcquiz/change_question_state.php?sessionid="+sessionid+"&cmid="+cmid+"&sesskey="+M.cfg.sesskey),req.send(),req.onload=()=>{document.getElementById("responseform").submit()}}),{once:!0});var updateNumAnswersEvent=setInterval((async()=>{await async function(sessionid,quizid,cmid,attemptid){var result=await fetch(M.cfg.wwwroot+"/mod/quiz/accessrule/tcquiz/quizdatateacher.php?requesttype=getnumberanswers&quizid="+quizid+"&sessionid="+sessionid+"&cmid="+cmid+"&attempt="+attemptid+"&sesskey="+M.cfg.sesskey,{method:"POST"}),responseXMLText=await result.text();await function(responseXMLText){var responseXML=(new DOMParser).parseFromString(responseXMLText,"text/html"),numberOfAnswers=responseXML.getElementsByTagName("tcquiz").item(0).getElementsByTagName("numanswers").item(0).textContent;document.querySelector(Selectors.regions.numAnswers).innerHTML=numberOfAnswers}(responseXMLText)}(sessionid,quizid,cmid,attemptid)}),POLLING_INTERVAL),timeLeft=timeForQuestion,timer=setInterval((function(){var timeLeftHTML=document.querySelector(Selectors.regions.timeLeft);timeLeft--,timeLeftHTML.innerHTML=timeLeft,timeLeft<=0&&(clearInterval(timer),timer=null,clearInterval(updateNumAnswersEvent),updateNumAnswersEvent=null,timeLeftHTML.innerHTML=0,document.getElementById("responseform").submit())}),1e3)};_exports.init=(sessionid,quizid,cmid,attemptid,page,timeForQuestion,POLLING_INTERVAL)=>{registerEventListeners(sessionid,quizid,cmid,attemptid,0,timeForQuestion,POLLING_INTERVAL)}}));

//# sourceMappingURL=teachercontrols.min.js.map