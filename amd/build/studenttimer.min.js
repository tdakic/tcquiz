define("quizaccess_tcquiz/studenttimer",["exports","core/str","core/notification","jquery"],(function(_exports,_str,_notification,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Countdown time the students have for answering the question. The timer can also be stopped by the teacher.
   *
   * @module     quizaccess_tcquiz
   * @copyright  2024 Capilano University
   * @author     Tamara Dakic <tdakic@capilanou.ca>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery);const Selectors_regions={timeLeft:'[data-region="quizaccess_tcquiz/timeleft_span"]'},registerEventListeners=(sessionid,quizid,cmid,attemptid,page,timeForQuestion,POLLING_INTERVAL)=>{(0,_jquery.default)("#responseform").on("submit",(function(){(0,_jquery.default)("#responseformsubmit").attr("disabled","disabled")})),window.addEventListener("beforeunload",(function(event){event.stopImmediatePropagation()}));var timeLeft=timeForQuestion,timeLeftHTML=document.querySelector(Selectors_regions.timeLeft),teacherEndedQuestion=!1,timer=setInterval((function(){timeLeft--,timeLeftHTML.innerHTML=timeLeft,(timeLeft<=0||teacherEndedQuestion)&&(clearInterval(timer),clearInterval(tecaherEndedQuestionEvent),timer=null,timeLeftHTML.innerHTML=0,window.goToCurrentQuizPageEvent=setInterval((async()=>{await async function(sessionid,quizid,cmid,attemptid){var result=await fetch(M.cfg.wwwroot+"/mod/quiz/accessrule/tcquiz/quizdatastudent.php?quizid="+quizid+"&sessionid="+sessionid+"&cmid="+cmid+"&attempt="+attemptid+"&sesskey="+M.cfg.sesskey,{method:"POST"}),responseXMLText=await result.text();await function(responseXMLText){const responseXML=(new DOMParser).parseFromString(responseXMLText,"text/html");var quizresponse=responseXML.getElementsByTagName("tcquiz").item(0);if(null===quizresponse)return void _notification.default.addNotification({message:(0,_str.get_string)("invalidserverresponse","quizaccess_tcquiz"),type:"error"});var quizstatus=quizresponse.getElementsByTagName("status").item(0).textContent;if("showquestion"==quizstatus);else if("showresults"==quizstatus){window.goToCurrentQuizPageEvent=null,clearInterval(window.goToCurrentQuizPageEvent);var resultURL=quizresponse.getElementsByTagName("url").item(0).textContent;window.location.replace(resultURL)}else if("finalresults"==quizstatus)window.goToCurrentQuizPageEvent=null,clearInterval(window.goToCurrentQuizPageEvent);else if("quiznotrunning"==quizstatus||"waitforquestion"==quizstatus||"waitforresults"==quizstatus||"noaction"==quizstatus);else if("error"==quizstatus){var errmsg=quizresponse.getElementsByTagName("message").item(0).textContent;_notification.default.addNotification({message:errmsg,type:"error"})}else _notification.default.addNotification({message:(0,_str.get_string)("unknownserverresponse","quizaccess_tcquiz")+quizstatus,type:"error"})}(responseXMLText)}(sessionid,quizid,cmid,attemptid)}),POLLING_INTERVAL))}),1e3);const tecaherEndedQuestionEvent=setInterval((async function(){teacherEndedQuestion=await async function(sessionid,quizid,cmid,attemptid){var result=await fetch(M.cfg.wwwroot+"/mod/quiz/accessrule/tcquiz/get_question_state.php?quizid="+quizid+"&sessionid="+sessionid+"&cmid="+cmid+"&attempt="+attemptid+"&sesskey="+M.cfg.sesskey,{method:"POST"});return"0"==await result.text()}(sessionid,quizid,cmid,attemptid)}),POLLING_INTERVAL)};_exports.init=(sessionid,quizid,cmid,attemptid,page,timeForQuestion,POLLING_INTERVAL)=>{registerEventListeners(sessionid,quizid,cmid,attemptid,0,timeForQuestion,POLLING_INTERVAL)}}));

//# sourceMappingURL=studenttimer.min.js.map